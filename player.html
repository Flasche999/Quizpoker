<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>QuizPoker – Spieler</title>
  <link rel="stylesheet" href="style.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <h1>QuizPoker – Spieler</h1>

  <div id="name-area">
    <label for="name">Dein Name:</label>
    <input type="text" id="name" />
    <button onclick="sendeName()">Beitreten</button>
  </div>

  <div id="game-area" style="display:none;">
    <div id="chips" style="margin-bottom:10px;">💰 Chips: <span id="chip-anzahl">–</span></div>
    <div id="einsatz" style="margin-bottom:10px;">🎯 Einsatz: <span id="einsatz-anzahl">–</span></div>
    <div id="pot" style="margin-bottom:10px;">🪙 Pot: <span id="pot-anzahl">0</span></div>
    <div id="frage">Warte auf Start...</div>

    <div id="antwort-bereich">
      <label for="antwort">Deine Schätzung:</label>
      <input type="number" id="antwort" />
      <button onclick="sendeAntwort()">Antwort senden</button>
    </div>

    <div id="aktionen" style="display:none;">
      <h3>Aktion wählen:</h3>
      <button onclick="spielerAktion('fold')">❌ Passen</button>
      <button onclick="spielerAktion('call')">➕ Mitgehen</button>
      <input type="number" id="raise-betrag" placeholder="Raise-Betrag" style="width:100px;" />
      <button onclick="spielerAktion('raise')">⬆️ Erhöhen</button>
      <button onclick="spielerAktion('allin')">💥 All In</button>
    </div>

    <div id="hinweis" style="margin-top:20px; font-weight:bold;"></div>
    <div id="ergebnis" style="margin-top:10px;"></div>

    <div id="spieler-uebersicht" style="margin-top: 30px;">
      <h3>Spielerübersicht</h3>
      <ul id="spieler-liste"></ul>
    </div>
  </div>

  <script>
    const socket = io();
    let name = "";
    let chips = 1000;
    let aktuelleAntwort = "";
    let aktuelleAktion = "";

    const spielerListe = document.getElementById("spieler-liste");
    const spielerStatus = new Map();

    function sendeName() {
      name = document.getElementById("name").value.trim();
      if (!name) return alert("Bitte Namen eingeben.");
      document.getElementById("name-area").style.display = "none";
      document.getElementById("game-area").style.display = "block";
      aktualisiereChipAnzeige();
      sendePlayerData();
    }

    function sendeAntwort() {
      aktuelleAntwort = document.getElementById("antwort").value;
      document.getElementById("antwort-bereich").style.display = "none";

      socket.emit("schaetzAntwort", parseInt(aktuelleAntwort));
    }

    function spielerAktion(aktion) {
      const raiseBetrag = document.getElementById("raise-betrag").value;
      socket.emit("spielerAktion", {
        aktion: aktion,
        raiseBetrag: raiseBetrag
      });
      document.getElementById("aktionen").style.display = "none";
    }

    function sendePlayerData() {
      socket.emit("playerData", {
        name: name,
        antwort: aktuelleAntwort,
        aktion: aktuelleAktion,
        chips: chips
      });
    }

    function aktualisiereChipAnzeige() {
      document.getElementById("chip-anzahl").textContent = chips;
    }

    function aktualisiereSpielerListe() {
      spielerListe.innerHTML = "";
      spielerStatus.forEach((info, spielerName) => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${spielerName}</strong>: ${info.aktion || "🕓 wartet"} (${info.chips} Chips)`;
        spielerListe.appendChild(li);
      });
    }

    socket.on("playerData", (data) => {
      spielerStatus.set(data.name, {
        aktion: data.aktion,
        chips: data.chips
      });
      aktualisiereSpielerListe();
    });

    socket.on("frageStart", (frage) => {
      document.getElementById("frage").textContent = frage.frage;
      document.getElementById("antwort").value = "";
      document.getElementById("antwort-bereich").style.display = "block";
      document.getElementById("aktionen").style.display = "none";
      document.getElementById("hinweis").textContent = "";
      document.getElementById("ergebnis").textContent = "";
      aktuelleAntwort = "";
      aktuelleAktion = "";

      spielerStatus.forEach((info, spielerName) => {
        info.aktion = "";
      });
      aktualisiereSpielerListe();
    });

    socket.on("hinweis", ({ num, text }) => {
      const hinweisDiv = document.getElementById("hinweis");
      hinweisDiv.textContent += `\n💡 Hinweis ${num}: ${text}`;
    });

    socket.on("aufloesung", (antwort) => {
      document.getElementById("ergebnis").textContent = "✅ Richtige Antwort: " + antwort;
    });

    socket.on("updateSpieler", (data) => {
      if (data.name === name) {
        chips = data.chips;
        aktualisiereChipAnzeige();
      }
    });

    socket.on("einsatzAktualisiert", (betrag) => {
      document.getElementById("einsatz-anzahl").textContent = betrag;
    });

    socket.on("potAktualisiert", (potWert) => {
      document.getElementById("pot-anzahl").textContent = potWert;
    });

    socket.on("aktionErlaubt", ({ aktuellerEinsatz, pot }) => {
      document.getElementById("aktionen").style.display = "block";
      document.getElementById("raise-betrag").value = aktuellerEinsatz + 20;
    });

    // ✅ Schätzantwort eines anderen Spielers wurde eingereicht (verdeckt)
    socket.on("zeigeSchaetzAntwortVerdeckt", ({ name }) => {
      const eintrag = document.createElement("li");
      eintrag.textContent = `${name} hat eine Schätzung abgegeben.`;
      spielerListe.appendChild(eintrag);
    });
  </script>
</body>
</html>
