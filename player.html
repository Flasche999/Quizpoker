<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>QuizPoker ‚Äì Spieler</title>
  <link rel="stylesheet" href="style.css" />
  <script src="/socket.io/socket.io.js"></script>
  <style>
    .game-wrapper {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .player-row,
    .player-column {
      display: flex;
      gap: 10px;
      position: absolute;
      z-index: 5;
    }

    .player-row.top {
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      flex-direction: row;
    }

    .player-row.bottom {
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      flex-direction: row;
    }

    .player-column.left {
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      flex-direction: column;
    }

    .player-column.right {
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      flex-direction: column;
    }

    .spieler-box {
      background: #1a1a1a;
      border-radius: 6px;
      padding: 8px;
      min-width: 120px;
      text-align: center;
      color: white;
    }

    .center-area {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .frage-box,
    .hinweis-box,
    .antwort-box,
    .pot-box {
      margin: 10px 0;
      padding: 10px;
      background: #222;
      border-radius: 8px;
    }

    .small-blind {
      color: #2196F3;
      font-weight: bold;
    }

    .big-blind {
      color: #f44336;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>QuizPoker ‚Äì Spieler</h1>

  <div id="name-area">
    <label for="name">Dein Name:</label>
    <input type="text" id="name" />
    <button onclick="sendeName()">Beitreten</button>
  </div>

  <div id="game-area" style="display:none;" class="game-wrapper">
    <div id="players-top" class="player-row top"></div>
    <div id="players-left" class="player-column left"></div>
    <div id="players-right" class="player-column right"></div>
    <div id="players-bottom" class="player-row bottom"></div>

    <div class="center-area">
      <div id="chips" style="margin-bottom:10px;">üí∞ Chips: <span id="chip-anzahl">‚Äì</span></div>
      <div id="pot" style="margin-bottom:10px;">ü™ô Pot: <span id="pot-anzahl">0</span></div>
      <div id="frage" class="frage-box">Warte auf Start...</div>

      <div id="antwort-bereich" class="antwort-box">
        <label for="antwort">Deine Sch√§tzung:</label>
        <input type="number" id="antwort" />
        <button onclick="sendeAntwort()">Antwort senden</button>
      </div>

      <div id="aktionen" style="display:none;">
        <h3>Aktion w√§hlen:</h3>
        <button onclick="spielerAktion('fold')">‚ùå Passen</button>
        <button onclick="spielerAktion('call')">‚ûï Mitgehen</button>
        <input type="number" id="raise-betrag" placeholder="Raise-Betrag" style="width:100px;" />
        <button onclick="spielerAktion('raise')">‚¨ÜÔ∏è Erh√∂hen</button>
        <button onclick="spielerAktion('allin')">üí• All In</button>
      </div>

      <div id="hinweis" class="hinweis-box" style="font-weight:bold;"></div>
      <div id="ergebnis" style="margin-top:10px;"></div>
    </div>
  </div>

  <script>
    const socket = io();
    let name = "";
    let chips = 1000;
    let aktuelleAntwort = "";
    let aktuelleAktion = "";

    const spielerStatus = new Map();
    let blinds = { small: "", big: "" };

    function sendeName() {
      name = document.getElementById("name").value.trim();
      if (!name) return alert("Bitte Namen eingeben.");
      document.getElementById("name-area").style.display = "none";
      document.getElementById("game-area").style.display = "block";
      aktualisiereChipAnzeige();
      sendePlayerData();
    }

    function sendeAntwort() {
      aktuelleAntwort = document.getElementById("antwort").value;
      document.getElementById("antwort-bereich").style.display = "none";
      socket.emit("schaetzAntwort", parseInt(aktuelleAntwort));
    }

    function spielerAktion(aktion) {
      const raiseBetrag = document.getElementById("raise-betrag").value;
      socket.emit("spielerAktion", {
        aktion: aktion,
        raiseBetrag: raiseBetrag
      });
      document.getElementById("aktionen").style.display = "none";
    }

    function sendePlayerData() {
      socket.emit("playerData", {
        name: name,
        antwort: aktuelleAntwort,
        aktion: aktuelleAktion,
        chips: chips
      });
    }

    function aktualisiereChipAnzeige() {
      document.getElementById("chip-anzahl").textContent = chips;
    }

    function aktualisiereSpielerPositionen() {
      const oben = document.getElementById("players-top");
      const unten = document.getElementById("players-bottom");
      const links = document.getElementById("players-left");
      const rechts = document.getElementById("players-right");

      oben.innerHTML = '';
      unten.innerHTML = '';
      links.innerHTML = '';
      rechts.innerHTML = '';

      const alleSpieler = Array.from(spielerStatus.keys());

      alleSpieler.forEach((spielerName, index) => {
        const info = spielerStatus.get(spielerName);
        const div = document.createElement("div");
        let blindClass = "";
        if (spielerName === blinds.small) blindClass = "small-blind";
        else if (spielerName === blinds.big) blindClass = "big-blind";

        div.className = `spieler-box ${blindClass}`;
        div.innerHTML = `<strong>${spielerName}</strong><br/>ü™ô ${info.chips}`;

        if (index === 0 || index === 4) links.appendChild(div);
        else if (index === 1 || index === 5) oben.appendChild(div);
        else if (index === 2 || index === 6) rechts.appendChild(div);
        else if (index === 3 || index === 7) unten.appendChild(div);
      });
    }

    socket.on("playerData", (data) => {
      spielerStatus.set(data.name, {
        aktion: data.aktion,
        chips: data.chips
      });
      aktualisiereSpielerPositionen();
    });

    socket.on("frageStart", (frage) => {
      document.getElementById("frage").textContent = frage.frage;
      document.getElementById("antwort").value = "";
      document.getElementById("antwort-bereich").style.display = "block";
      document.getElementById("aktionen").style.display = "none";
      document.getElementById("hinweis").textContent = "";
      document.getElementById("ergebnis").textContent = "";
      aktuelleAntwort = "";
      aktuelleAktion = "";

      spielerStatus.forEach((info, spielerName) => {
        info.aktion = "";
      });
      aktualisiereSpielerPositionen();
    });

    socket.on("hinweis", ({ num, text }) => {
      const hinweisDiv = document.getElementById("hinweis");
      hinweisDiv.innerHTML += `üí° Hinweis ${num}: ${text}<br/>`;
    });

    socket.on("aufloesung", (antwort) => {
      document.getElementById("ergebnis").textContent = "‚úÖ Richtige Antwort: " + antwort;
    });

    socket.on("updateSpieler", (data) => {
      if (data.name === name) {
        chips = data.chips;
        aktualisiereChipAnzeige();
      }
    });

    socket.on("einsatzAktualisiert", (betrag) => {
      document.getElementById("einsatz-anzahl").textContent = betrag;
    });

    socket.on("potAktualisiert", (potWert) => {
      document.getElementById("pot-anzahl").textContent = potWert;
    });

    socket.on("aktionErlaubt", ({ aktuellerEinsatz }) => {
      document.getElementById("aktionen").style.display = "block";
      document.getElementById("raise-betrag").value = aktuellerEinsatz + 20;
    });

    socket.on("zeigeSchaetzAntwortVerdeckt", ({ name }) => {
      const hinweisDiv = document.getElementById("hinweis");
      hinweisDiv.innerHTML += `üì® ${name} hat geantwortet<br/>`;
    });

    socket.on("blindsMarkieren", (data) => {
      blinds = data;
      aktualisiereSpielerPositionen();
    });
  </script>
</body>
</html>
